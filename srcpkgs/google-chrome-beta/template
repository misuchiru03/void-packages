# Template file for 'google-chrome-beta'
_chromeVersion=91.0.4472.77
_chromeRevision=current
_channel=beta

pkgname=google-chrome-beta
version="${_chromeVersion}.${_channel}"
revision=1
maintainer="Michael Aldridge <maldridge@voidlinux.org>"
homepage="https://www.google.com/chrome/"
license="custom:chrome"
short_desc="Attempt at creating a safer, faster, and more stable browser"
archs="x86_64"
hostmakedepends="curl tar xz python3 python3-html2text python3-setuptools"
repository=nonfree
restricted=yes
nostrip=yes

_baseUrl="https://dl.google.com/linux/direct"
_filename="google-chrome-${_channel}_${_chromeRevision}_amd64.deb"
_chromeUrl="${_baseUrl}/${_filename}"
_licenseUrl="https://www.google.com/intl/en/chrome/terms/"

distfiles="$_chromeUrl"
checksum=c0ab9d6ec1055b65ed87420be99eba6df25bc83a1d63f2ed8340ba3d77ceaaba

do_extract() {
	mkdir -p ${DESTDIR}
	ar x ${XBPS_SRCDISTDIR}/google-chrome-beta-${version}/${_filename}
}

do_install() {
	tar xf data.tar.xz -C ${DESTDIR}

	# Install the icons
	for size in 16 24 32 48 64 128 256; do
		# Create the google chrome xdg directory
		mkdir -p ${DESTDIR}/usr/share/icons/hicolor/${size}x${size}/apps

		# Copy the google chrome icon
		mv ${DESTDIR}/opt/google/chrome-beta/product_logo_${size}_beta.png \
		   ${DESTDIR}/usr/share/icons/hicolor/${size}x${size}/apps/google-chrome.png
	done

	# Remove unused icons
	rm ${DESTDIR}/opt/google/chrome-beta/*.xpm

	# Remove the Debian/Ubuntu crontab
	rm -rf ${DESTDIR}/etc
	rm -rf ${DESTDIR}/opt/google/chrome-beta/cron
}

post_install() {
	curl ${_licenseUrl} | html2text >> google-chrome-eula.md
	vlicense google-chrome-eula.md
}
