# Template file for 'emby-server'
pkgname=emby-server
version=4.8.8.0
revision=1
archs="x86_64 armv7l aarch64"
create_wrksrc=yes
hostmakedepends="tar xz"
short_desc="Bring together your videos, music, photos, and live television"
maintainer="Alex Childs <misuchiru03+github@gmail.com>"
license="GPL-3.0-or-later"
homepage="https://emby.media"
system_accounts="_emby"
nopie=yes
noverifyrdeps=yes

case "$XBPS_TARGET_MACHINE" in
	    x86_64*)
		distfiles="https://github.com/MediaBrowser/Emby.Releases/releases/download/${version}/emby-server-deb_${version}_amd64.deb"
		checksum="707e50e47b0cf7c8c2c36244e45b64f6e38c3488ed4d4e592d2afb75298e353c"
		;;
	armv7*)
		distfiles="https://github.com/MediaBrowser/Emby.Releases/releases/download/${version}/emby-server-deb_${version}_armhf.deb"
		checksum="a3023de9aa2f135af6bb07ffcde9781dc9b9ec8a99727211c09e637e49a54d27"
		;;
	aarch64*)
		distfiles="https://github.com/MediaBrowser/Emby.Releases/releases/download/${version}/emby-server-deb_${version}_arm64.deb"
		checksum="642f57c58b3bc749729e8543a90f3c73aedfa84ef3924cfa35e5fb5dcd178991"
		;;
esac


make_dirs="/opt/emby-server 0755 _emby _emby"
make_dirs="/var/lib/emby 0755 _emby _emby"

do_extract() {
	fn="${distfiles##*/}"
	ar x "${XBPS_SRCDISTDIR}/${pkgname}-${version}/${fn}"
	tar xf data.tar.xz
	mkdir -p etc opt usr
}

do_install() {
	vcopy etc /
	vcopy usr /
	vcopy opt /
	vsv emby-server
}
