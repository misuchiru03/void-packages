# Template file for 'emby-server'
pkgname=emby-server
version=4.8.5.0
revision=1
archs="x86_64 armv7l aarch64"
create_wrksrc=yes
hostmakedepends="tar xz"
short_desc="Bring together your videos, music, photos, and live television"
maintainer="Alex Childs <misuchiru03+github@gmail.com>"
license="GPL-3.0-or-later"
homepage="https://emby.media"
system_accounts="_emby"
nopie=yes
noverifyrdeps=yes

case "$XBPS_TARGET_MACHINE" in
	    x86_64*)
		distfiles="https://github.com/MediaBrowser/Emby.Releases/releases/download/${version}/emby-server-deb_${version}_amd64.deb"
		checksum="dc075d362954be17f233b445ac5b7ba29b5fb4ef5f3248ba30ecba59d825fb63"
		;;
	armv7*)
		distfiles="https://github.com/MediaBrowser/Emby.Releases/releases/download/${version}/emby-server-deb_${version}_armhf.deb"
		checksum="2f4876955be03f54438dbf49315305271d716306841add75e183d85bc514e47d"
		;;
	aarch64*)
		distfiles="https://github.com/MediaBrowser/Emby.Releases/releases/download/${version}/emby-server-deb_${version}_arm64.deb"
		checksum="dd4da74c72deff1b7be15bf130a1c8fd72d8be1cf0e3ca55a63fab3e52b9733b"
		;;
esac


make_dirs="/opt/emby-server 0755 _emby _emby"
make_dirs="/var/lib/emby 0755 _emby _emby"

do_extract() {
	fn="${distfiles##*/}"
	ar x "${XBPS_SRCDISTDIR}/${pkgname}-${version}/${fn}"
	tar xf data.tar.xz
	mkdir -p etc opt usr
}

do_install() {
	vcopy etc /
	vcopy usr /
	vcopy opt /
	vsv emby-server
}
