# Template file for 'emby-server'
pkgname=emby-server
version=4.8.3.0
revision=1
archs="x86_64 armv7l aarch64"
create_wrksrc=yes
hostmakedepends="tar xz"
short_desc="Bring together your videos, music, photos, and live television"
maintainer="Alex Childs <misuchiru03+github@gmail.com>"
license="GPL-3.0-or-later"
homepage="https://emby.media"
checksum=90121b571308d8c3b597fe7af09d90712d0c188aa5ae8cf76e400363784bd449
system_accounts="_emby"
nopie=yes
noverifyrdeps=yes

case "$XBPS_TARGET_MACHINE" in
	    x86_64*)
		distfiles="https://github.com/MediaBrowser/Emby.Releases/releases/download/${version}/emby-server-deb_${version}_amd64.deb"
		checksum="90121b571308d8c3b597fe7af09d90712d0c188aa5ae8cf76e400363784bd449"
		;;
	armv7*)
		distfiles="https://github.com/MediaBrowser/Emby.Releases/releases/download/${version}/emby-server-deb_${version}_armhf.deb"
		checksum="f45fcd003d39894d25b3b14b94fddcbd1b2c8ffb796b66ec5270af44d02b86b5"
		;;
	aarch64*)
		distfiles="https://github.com/MediaBrowser/Emby.Releases/releases/download/${version}/emby-server-deb_${version}_arm64.deb"
		checksum="014d87410346bf2fb2e19e3923d17232fd1edb42c7f2f2128e7f4514487a0842"
		;;
esac


make_dirs="/opt/emby-server 0755 _emby _emby"
make_dirs="/var/lib/emby 0755 _emby _emby"

do_extract() {
	fn="${distfiles##*/}"
	ar x "${XBPS_SRCDISTDIR}/${pkgname}-${version}/${fn}"
	tar xf data.tar.xz
	mkdir -p etc opt usr
}

do_install() {
	vcopy etc /
	vcopy usr /
	vcopy opt /
	vsv emby-server
}
