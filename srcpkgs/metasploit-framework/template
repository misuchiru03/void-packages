# Template file for 'metasploit-framework'
pkgname=metasploit-framework
version=5.0.30+20190613
revision=1
archs="x86_64 i686 aarch64 armv7l armv7hf"
short_desc="Security testing framework"
maintainer="Alex Childs <misuchiru03+void@gmail.com>"
license="BSD-3-Clause"
homepage="https://rapid7.com"

if [ "$XBPS_TARGET_MACHINE" == "i686" ]; then
	version=5.0.30+20190613
	_timestamp=190951
	_arch="i386"
	distfiles="http://downloads.metasploit.com/data/releases/metasploit-framework/apt/pool/main/m/metasploit-framework/metasploit-framework_${version}${_timestamp}~1rapid7-1_${_arch}.deb"
	checksum=172d4ed299ebefff4df8611881369fa64f1f5f63246845b44561e48872eb559d
elif [ "$XBPS_TARGET_MACHINE" == "x86_64" ]; then
	version=5.0.30+20190613
	_timestamp=190935
	_arch="amd64"
	distfiles="http://downloads.metasploit.com/data/releases/metasploit-framework/apt/pool/main/m/metasploit-framework/metasploit-framework_${version}${_timestamp}~1rapid7-1_${_arch}.deb"
	checksum=10d9f92ab047d6fb9dd106b1985535bc39bc9142cc8edc86810a9e19a392df4d
elif [ "$XBPS_TARGET_MACHINE" == "aarch64" ]; then
	version=5.0.29+20190609
	_timestamp=093353
	_arch="arm64"
	distfiles="http://downloads.metasploit.com/data/releases/metasploit-framework/apt/pool/main/m/metasploit-framework/metasploit-framework_${version}${_timestamp}~1rapid7-1_${_arch}.deb"
	checksum=822e03d1df55abd2ec61d301520f095c862d9c424893186ea70cf49f735fc63f
elif [ "$XBPS_TARGET_MACHINE" == "armv7hf" ] || [ "$XBPS_TARGET_MACHINE" == "armv7l" ]; then
	version=5.0.27+20190606
	_timestamp=093410
	_arch="armhf"
	distfiles="http://downloads.metasploit.com/data/releases/metasploit-framework/apt/pool/main/m/metasploit-framework/metasploit-framework_${version}${_timestamp}~1rapid7-1_${_arch}.deb"
	checksum=0ad59020734b804073236e6472b79e996ad7ad610079d4179b05fe936d0c53b9
fi

nopie=yes
nostrip=yes
noverifyrdeps=yes

do_extract() {
	ar x ${XBPS_SRCDISTDIR}/${pkgname}-${version}/${pkgname}_${version}${_timestamp}~1rapid7-1_${_arch}.deb
	tar xf data.tar.gz
	rm -f opt/metasploit-framework/bin/msfupdate
}

do_install() {
	cp -r opt ${DESTDIR}
	for i in opt/metasploit-framework/bin/*; do
		vbin ${i}
	done
}

post_install() {
	vlicense opt/metasploit-framework/LICENSE
}
