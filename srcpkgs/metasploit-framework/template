# Template file for 'metasploit-framework'
pkgname=metasploit-framework
_date=20210514
version=6.0.45
revision=1
archs="x86_64 i686 aarch64 armv7l armv7hf"
short_desc="Security testing framework"
depends="postgresql"
maintainer="Alex Childs <misuchiru03+void@gmail.com>"
license="BSD-3-Clause"
homepage="https://rapid7.com"
python_version="2"

if [ "$XBPS_TARGET_MACHINE" == "i686" ]; then
	version=6.0.45
	_timestamp=20210514102554
	_arch="i386"
	distfiles="http://downloads.metasploit.com/data/releases/metasploit-framework/apt/pool/main/m/metasploit-framework/metasploit-framework_${version}+${_timestamp}~1rapid7-1_${_arch}.deb"
	checksum=0b63e1bf99a889eec94f0d2ac13c350bf05b89f8f76322d2e30a71f866c6d333
elif [ "$XBPS_TARGET_MACHINE" == "x86_64" ]; then
	version=6.0.45
	_timestamp=20210514102537
	_arch="amd64"
	distfiles="http://downloads.metasploit.com/data/releases/metasploit-framework/apt/pool/main/m/metasploit-framework/metasploit-framework_${version}+${_timestamp}~1rapid7-1_${_arch}.deb"
	checksum=1c889d21bbe361fb851203b43bd95da46d4158f3adf7d19f43bf61a877c86e61
elif [ "$XBPS_TARGET_MACHINE" == "aarch64" ]; then
	version=6.0.45
	_timestamp=20210514093414
	_arch="arm64"
	distfiles="http://downloads.metasploit.com/data/releases/metasploit-framework/apt/pool/main/m/metasploit-framework/metasploit-framework_${version}+${_timestamp}~1rapid7-1_${_arch}.deb"
	checksum=90bacdf9d7fe2f191425c168556be814930b8f91243bd85b6420d5e6239ce70d
elif [ "$XBPS_TARGET_MACHINE" == "armv7hf" ] || [ "$XBPS_TARGET_MACHINE" == "armv7l" ]; then
	version=6.0.44
	_timestamp=20210513094418
	_arch="armhf"
	distfiles="http://downloads.metasploit.com/data/releases/metasploit-framework/apt/pool/main/m/metasploit-framework/metasploit-framework_${version}+${_timestamp}~1rapid7-1_${_arch}.deb"
	checksum=b7ad65d2f5bb275a040fcaf4158aa272c7bbb85fea94ed089d5e10f5714ef6a0
fi

nopie=yes
nostrip=yes
noverifyrdeps=yes

do_extract() {
	ar x ${XBPS_SRCDISTDIR}/${pkgname}-${version}/${pkgname}_${version}+${_timestamp}~1rapid7-1_${_arch}.deb
	bsdtar xf data.tar.gz
	rm -f opt/metasploit-framework/bin/msfupdate
}

do_install() {
	cp -r opt ${DESTDIR}
	for i in opt/metasploit-framework/bin/*; do
		vbin ${i}
	done
}

post_install() {
	vlicense opt/metasploit-framework/LICENSE
}
