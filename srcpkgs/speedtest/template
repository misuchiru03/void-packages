# Template file for 'speedtest'
pkgname=speedtest
version=1.2.0
revision=1
archs="i686 x86_64 armv6l aarch64 armv7l armv7hf"
create_wrksrc=yes
hostmakedepends="wget tar"
short_desc="Official Ookla speedtest command line client"
maintainer="Alex Childs <misuchiru03+void@gmail.com>"
license="custom:proprietary"
homepage="https://www.speedtest.net/"
conflicts="speedtest-cli>=0"

_filename="speedtest-${version}.tar.gz"

if [ "$XBPS_TARGET_MACHINE" == "i686" ]; then
	distfiles="https://install.speedtest.net/app/cli/ookla-speedtest-${version}-linux-i386.tgz"
	checksum=3953d231da3783e2bf8904b6dd72767c5c6e533e163d3742fd0437affa431bd3
elif [ "$XBPS_TARGET_MACHINE" == "x86_64" ]; then
	distfiles="https://install.speedtest.net/app/cli/ookla-speedtest-${version}-linux-x86_64.tgz"
	checksum=5690596c54ff9bed63fa3732f818a05dbc2db19ad36ed68f21ca5f64d5cfeeb7
elif [ "$XBPS_TARGET_MACHINE" == "armv6l" ]; then
	distfiles="https://install.speedtest.net/app/cli/ookla-speedtest-${version}-linux-armel.tgz"
	checksum=629a455a2879224bd0dbd4b36d8c721dda540717937e4660b4d2c966029466bf
elif [ "$XBPS_TARGET_MACHINE" == "armv7l" ]; then
	distfiles="https://install.speedtest.net/app/cli/ookla-speedtest-${version}-linux-armel.tgz"
	checksum=629a455a2879224bd0dbd4b36d8c721dda540717937e4660b4d2c966029466bf
elif [ "$XBPS_TARGET_MACHINE" == "armv7hf" ]; then
	distfiles="https://install.speedtest.net/app/cli/ookla-speedtest-${version}-linux-armhf.tgz"
	checksum=e45fcdebbd8a185553535533dd032d6b10bc8c64eee4139b1147b9c09835d08d
elif [ "$XBPS_TARGET_MACHINE" == "aarch64" ]; then
	distfiles="https://install.speedtest.net/app/cli/ookla-speedtest-${version}-linux-aarch64.tgz"
	checksum=3953d231da3783e2bf8904b6dd72767c5c6e533e163d3742fd0437affa431bd3
fi

do_fetch() {
	wget ${distfiles} -O ${_filename}
}

do_extract() {
	tar zxf ../${_filename}
}

do_install() {
	vbin speedtest
	vman speedtest.5
	vlicense ${FILESDIR}/LICENSE
}
